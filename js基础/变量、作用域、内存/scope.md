#### 执行环境（执行上下文）

执行环境（execution context）是javascript最为重要的一个概念。**执行环境**定义了**变量**或**函数**有权访问的其他数据，决定了它们各自的行为。每一个执行环境都有一个与之关联的**变量对象**，环境中定义的变量和函数都保存在这个对象中。javascript中的执行环境可以分为两种：**全局执行环境**和**函数执行环境**

##### 全局执行环境

全局执行环境是最外围的一个执行环境。ECMAScript实现所在的宿主环境不同，表示执行环境的对象也不一样。在web浏览器中，全局执行环境被认为是windows对象。因此所有全局变量和函数都作为windows对象的属性和方法。某个执行环境执行完所有代码之后，该环境会被销毁，保留在该执行环境中的变量和方法也随之销毁（全局执行环境直到应用程序退出--例如关闭网页或浏览器时才会被销毁）

##### 函数执行环境

每一个函数都有自己的**执行环境**。当执行流进入一个函数时，函数的环境就会被推入一个环境栈（stack：遵循后进先出的原则）中。而在函数执行之后，栈将其环境弹出，把控制权返回给之前的执行环境。

#### 作用域

当代码在以一个环境中执行，就会创建**变量对象**的一个**作用域链**，作用域链的作用是：保证对执行环境中有权访问的所有变量和函数的**有序访问**。
如果这个环境是函数，则将其**活动对象**作为变量对象。活动对象最开始时只包含一个变量，即arguments对象（全局环境中不存在）。作用域链中的下一个变量对象来自外部（包含当前这个环境）环境，而下一个变量对象又是来自下一个外部环境。一直延续到全局执行环境。全局执行环境的变量对象始终是作用域链的最后一个对象。

标识符解析是沿着作用域链一级一级地搜索标识符的过程，搜索过程始终从作用域链的前端开始，然后逐级向后回溯，直到全局执行环境。如若找不到标识符，通常会引起错误发生。

```
var color = 'blue'

function changeColor () {
    var anotherColor = 'red'
    function swapColor (aa) {
        var tempColor = anotherColor
        anotherColor = color
        color = tempColor

        // 这里可以访问 color anotherColor tempColor
    }

    // 这里可以访问 color anotherColor
}
// 这里可以访问 color

changeColor()

以上代码共涉及3个执行环境：全局环境、changeColor函数局部环境、swapColor函数局部环境

全局环境：
    --color【变量】
    --changeColor()
        --anotherColor【变量】

        --swapColor()
            --tempColor【变量】
            --aa【参数也当作变量来对待】

从上可知：1、内部环境可以通过作用域链访问所有的外部环境，但外部环境不能访问内部环境中的任何变量和函数。（这些环境之间的联系是线性、有次序的）
        2、每个环境都可以向上搜索作用域链，已查询变量和函数名。
```
注意：javascript没有块级作用域（只有全局和函数作用域）

这就导致：
```
if(true){
    var color = 'blue'
}
console.log(color) // 'blue'

for(var i = 0 ; i < 100 ; i++) {
    dosomething(i)
}
alert(i) // 100

对于没有块级作用域的语言来说，for语句初始化变量的表达式所定义的变量，会在循环结束之后，依旧存在于循环外部的执行环境中。
```
