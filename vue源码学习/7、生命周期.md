这篇我们讲述生命周期相关内容。

首先我们看一张生命周期图
![生命周期](./images/生命周期.jpg)

从上图，我们看到，vue实例的生命周期可以分为四阶段

    * 初始化阶段
    * 模板编译阶段
    * 挂载阶段
    * 销毁阶段

### 初始化阶段

    我们都知道，new Vue({options}) 来创建一个vue的实例。那构造函数Vue做了什么呢？ 在源码中src/core/instance/index.js可以看到

```
// 创建vue实例，做了一件事。调用了构造函数Vue原型上绑定的方法_init方法。
function Vue (options) {
    this._init(options);
}
// 构造函数Vue原型上的_init方法是在initMixin方法内定义的
initMixin(Vue);
stateMixin(Vue);
eventsMixin(Vue);
lifecycleMixin(Vue);
renderMixin(Vue);

```
接下来我们看看initMixin做了什么
```
// vue/src/core/instance/init.js
function initMixin (Vue) {
    Vue.prototype._init = function (options) {
      // this(vue的实例)赋值给vm  
      var vm = this;
      vm.$options = mergeOptions(
        resolveConstructorOptions(vm.constructor),
        options || {},
        vm
      )
      {
        initProxy(vm);
      }
      vm._self = vm;
      initLifecycle(vm); // 初始化生命周期
      initEvents(vm); // 初始化事件
      initRender(vm); // 初始化渲染
      callHook(vm, 'beforeCreate'); // 调用beforeCreate生命周期钩子函数

      // 初始化initInjections（主要为provide/inject提供的特性，允许一个祖先组件向其所有子孙后代注入一个依赖，不论组件层次有多深，并在其上下游关系成立的时间里始终生效。）
      initInjections(vm);  
      initState(vm); // 初始化props、methods、data、watch
      initProvide(vm);  初始化 provide
      callHook(vm, 'created');// 调用created生命周期钩子函数

      if (vm.$options.el) { // 判断是否传入了el
        vm.$mount(vm.$options.el); // 执行vm.$mount进入下一个生命周期
      }
    };
}
```

#### 合并属性

#### callback函数如何触发钩子函数

```
// src/core/instance/lifecycle.js
function callHook (vm, hook) {
    pushTarget();
    var handlers = vm.$options[hook];
    var info = hook + " hook";
    if (handlers) {
      for (var i = 0, j = handlers.length; i < j; i++) {
         try {
            handlers[i].apply(vm)
        } catch (e) {
            handleError(e, vm, info);
        }
      }
    }
    popTarget();
}
```
从上方代码看，逻辑还是比较简单的，就是从实例的$options获取对应的钩子函数的名称（hook）所对应的钩子函数数组handlers,然后遍历该数组，将数组中的每个钩子函数都执行一遍。