### TCP和UDP的差别

TCP/IP协议是一个协议簇(cu.族群的意思)。这里面包括很多协议（http、ip、tcp、udp、dns等等）

TCP/IP协议集包括应用层、传输层、网络层、数据链路层、物理层

而其中的应用层包括HTTP、DNS、FTP、等协议

传输层包括：TCP(传输控制协议)、UDP(用户数据报协议)

下面重点TCP和UDP都是同处于传输层的协议

TCP:是一种面向连接的、可靠的、基于字节流的传输层通信协议。

面向连接，在收发数据之前，必须和对方建立可靠的连接。一个TCP必须经历三次握手才能建起连接。断开连接则需要经历四次挥手。具体可以参考[http协议](./http协议.md)

```
三次握手（建立连接）
第一次握手：主机A通过向主机B 发送一个含有同步序列号的标志位的数据段给主机B，向主机B 请求建立连接，通过这个数据段， 主机A告诉主机B 两件事：我想要和你通信；你可以用哪个序列号作为起始数据段来回应我。

第二次握手：主机B 收到主机A的请求后，用一个带有确认应答（ACK）和同步序列号（SYN）标志位的数据段响应主机A，也告诉主机A两件事：我已经收到你的请求了，你可以传输数据了；你要用那个序列号作为起始数据段来回应我

第三次握手：主机A收到这个数据段后，再发送一个确认应答，确认已收到主机B 的数据段："我已收到回复，我现在要开始传输实际数据了，这样3次握手就完成了，主机A和主机B 就可以传输数据了。

四次挥手（断开连接）
第一次： 当主机A完成数据传输后,将控制位FIN置1，提出停止TCP连接的请求 ；

第二次： 主机B收到FIN后对其作出响应，确认这一方向上的TCP连接将关闭,将ACK置1；

第三次： 由B 端再提出反方向的关闭请求,将FIN置1 ；

第四次： 主机A对主机B的请求进行确认，将ACK置1，双方向的关闭结束.

解释：
1、ACK 是TCP报头的控制位之一，对数据进行确认。确认由目的端发出， 用它来告诉发送端这个序列号之前的数据段都收到了。 比如确认号为X，则表示前X-1个数据段都收到了，只有当ACK=1时,确认号才有效，当ACK=0时，确认号无效，这时会要求重传数据，保证数据的完整性。

2、SYN 同步序列号，TCP建立连接时将这个位置1。

3、FIN 发送端完成发送任务位，当TCP完成数据传输需要断开时,，提出断开连接的一方将这位置1。
```

UDP: 支持一个无连接的传输协议,传输数据之前源端和终端不需要建立连接。

2、由于传输数据不需要连接，因此也不需要维护连接状态，包括收发状态等，因此一台服务机可以同时向多个客户机传输相同的消息。

3、UDP信息包的标题很短，只有8个字节，相对于TCP的20个字节信息包的额外开销很小。

4、吞吐量不受拥挤控制算法的调节，只受应用软件生成数据的速率、传输带宽、 源端和终端主机性能的限制。

5、UDP使用尽最大努力交付，即不保证可靠交付， 因此主机不需要维持复杂的链接状态表（这里面有许多参数）。

6、UDP是面向报文的。发送方的UDP对应用程序交下来的报文， 在添加首部后就向下交付给IP层。既不拆分，也不合并，而是保留这些报文的边界， 因此，应用程序需要选择合适的报文大小。

TCP和UDP的区别：

1. 基于连接（TCP）与无连接(UDP)
2. 对系统资源的要求（TCP较多，UDP较少）
3. UDP程序结构简单
4. 流模式与数据报模式 
5. TCP保证数据准确性，UDP可能丢包
6. TCP保证数据顺序，UDP不保证

UDP开销小、处理速度块的优点。所以通常音频、视频和普通数据在传送时使用UDP较多，因为它们即使偶尔丢失一两个数据包，也不会对接收结果产生太大影响。比如我们聊天用的ICQ和QQ就是使用的UDP协议。

